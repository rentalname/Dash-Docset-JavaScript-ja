<!DOCTYPE html>
<html lang="ja" dir="ltr" class="redesign no-js">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">
  <script>(function(d) { d.className = d.className.replace(/\bno-js/, ''); })(document.documentElement);</script>
          <script src="https://cdn.optimizely.com/js/237572123.js"></script>
  
    <title>Internals - SpiderMonkey | MDN</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="index, follow">
  <link rel="home" href="../../index.html">
  <link rel="copyright" href="Internals.html#copyright">

  <link href="https://mozorg.cdn.mozilla.net/media/css/tabzilla-min.css" type="text/css" rel="stylesheet">
              <link rel="stylesheet" media="all" href="https://developer.cdn.mozilla.net/media/css/mdn-min.css?build=46533d5" />

      
    <link rel="stylesheet" media="all" href="https://developer.cdn.mozilla.net/media/css/wiki-min.css?build=46533d5" />

    
    
  <!-- common social tags -->
    <meta property="og:type" content="website">
  <meta property="og:image" content="https://developer.mozilla.org/media/redesign/img/opengraph-logo.png">
  <meta property="og:site_name" content="Mozilla Developer Network">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="https://developer.mozilla.org/media/redesign/img/opengraph-logo.png">
  <meta name="twitter:site" content="@NewOnMDN">
  <meta name="twitter:creator" content="@NewOnMDN">

  <link rel="search" type="application/opensearchdescription+xml" href="../../search/xml" title="Mozilla Developer Network">

  <!-- third-generation iPad with high-resolution Retina display: -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://developer.cdn.mozilla.net/media/redesign/img/favicon144.png">
  <!-- iPhone with high-resolution Retina display: -->
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://developer.cdn.mozilla.net/media/redesign/img/favicon114.png">
  <!-- first- and second-generation iPad: -->
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://developer.cdn.mozilla.net/media/redesign/img/favicon72.png">
  <!-- non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon-precomposed" href="https://developer.cdn.mozilla.net/media/redesign/img/favicon57.png">
  <!-- basic favicon -->
          <link rel="shortcut icon" href="https://developer.cdn.mozilla.net/media/redesign/img/favicon32.png">
  <!--[if IE]>
  <meta http-equiv="imagetoolbar" content="no">
  <script src="https://developer.cdn.mozilla.net/media/js/libs/html5.js"></script>
  <![endif]-->

    <link rel="alternate" type="application/json" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/Internals$json">
  <link rel="canonical" href="Internals.html" >

            <link rel="alternate" hreflang="en-US" href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Internals" title="SpiderMonkey Internals">
          <link rel="alternate" hreflang="zh-CN" href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Projects/SpiderMonkey/Internals" title="SpiderMonkey Internals">
      
  <!-- document-specific social tags -->
  <meta property="og:title" content="Internals">
  <meta property="og:url" content="https://developer.mozilla.org/ja/docs/SpiderMonkey/Internals">
  <meta name="twitter:url" content="https://developer.mozilla.org/ja/docs/SpiderMonkey/Internals">
  <meta name="twitter:title" content="Internals">
    <meta property="og:description" content="At heart, SpiderMonkey is a fast interpreter that runs an untyped bytecode and operates on values of type jsval —type-tagged double-sized values that represent the full range of JavaScript values. In addition to the interpreter, SpiderMonkey contains a Just-In-Time (JIT) compiler, a garbage collector, code implementing the basic behavior of JavaScript values, a standard library implementing ECMA 262-3 §15 with various extensions, and a few public APIs.">
  <meta name="description" content="At heart, SpiderMonkey is a fast interpreter that runs an untyped bytecode and operates on values of type jsval —type-tagged double-sized values that represent the full range of JavaScript values. In addition to the interpreter, SpiderMonkey contains a Just-In-Time (JIT) compiler, a garbage collector, code implementing the basic behavior of JavaScript values, a standard library implementing ECMA 262-3 §15 with various extensions, and a few public APIs.">
  <meta name="twitter:description" content="At heart, SpiderMonkey is a fast interpreter that runs an untyped bytecode and operates on values of type jsval —type-tagged double-sized values that represent the full range of JavaScript values. In addition to the interpreter, SpiderMonkey contains a Just-In-Time (JIT) compiler, a garbage collector, code implementing the basic behavior of JavaScript values, a standard library implementing ECMA 262-3 §15 with various extensions, and a few public APIs.">
  
      <script type="text/javascript">

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-36116321-5', 'mozilla.org');
    ga('set', 'anonymizeIp', true);

    
    
    
    
    (function() {
        // http://cfsimplicity.com/61/removing-analytics-clutter-from-campaign-urls
        var win = window;
        var removeUtms = function(){
            var location = win.location;
            if (location.hash.indexOf('utm') != -1) {
                var anchor = location.hash.match(/#(?!utm)[^&]+/);
                anchor = anchor ? anchor[0] : '';
                if(!anchor && win.history.replaceState){
                    history.replaceState({}, '', location.pathname + location.search);
                } else {
                    location.hash = anchor;
                }
            }
        };

        ga('send', 'pageview', removeUtms(win.location + ''));
    })();
</script>
  <script type="text/javascript">(window.NREUM||(NREUM={})).loader_config={xpid:"VgAEV1RTGwABU1NSAAQ="};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o?o:e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({QJf3ax:[function(t,e){function n(t){function e(e,n,a){t&&t(e,n,a),a||(a={});for(var c=s(e),u=c.length,f=i(a,o,r),d=0;u>d;d++)c[d].apply(f,n);return f}function a(t,e){u[t]=s(t).concat(e)}function s(t){return u[t]||[]}function c(){return n(e)}var u={};return{on:a,emit:e,create:c,listeners:s,_events:u}}function r(){return{}}var o="nr@context",i=t("gos");e.exports=n()},{gos:"7eSDFh"}],ee:[function(t,e){e.exports=t("QJf3ax")},{}],3:[function(t){function e(t,e,n,i,s){try{c?c-=1:r("err",[s||new UncaughtException(t,e,n)])}catch(u){try{r("ierr",[u,(new Date).getTime(),!0])}catch(f){}}return"function"==typeof a?a.apply(this,o(arguments)):!1}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function n(t){r("err",[t,(new Date).getTime()])}var r=t("handle"),o=t(4),i=t("ee"),a=window.onerror,s=!1,c=0;t("loader").features.err=!0,window.onerror=e,NREUM.noticeError=n;try{throw new Error}catch(u){"stack"in u&&(t(5),t(3),"addEventListener"in window&&t(1),window.XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.addEventListener&&t(2),s=!0)}i.on("fn-start",function(){s&&(c+=1)}),i.on("fn-err",function(t,e,r){s&&(this.thrown=!0,n(r))}),i.on("fn-end",function(){s&&!this.thrown&&c>0&&(c-=1)}),i.on("internal-error",function(t){r("ierr",[t,(new Date).getTime(),!0])})},{1:4,2:7,3:5,4:18,5:6,ee:"QJf3ax",handle:"D5DuLP",loader:"G9z0Bl"}],4:[function(t,e){function n(t){i.inPlace(t,["addEventListener","removeEventListener"],"-",r)}function r(t){return t[1]}var o=(t(1),t("ee").create()),i=t(2)(o),a=t("gos");if(e.exports=o,n(window),"getPrototypeOf"in Object){for(var s=document;s&&!s.hasOwnProperty("addEventListener");)s=Object.getPrototypeOf(s);s&&n(s);for(var c=XMLHttpRequest.prototype;c&&!c.hasOwnProperty("addEventListener");)c=Object.getPrototypeOf(c);c&&n(c)}else XMLHttpRequest.prototype.hasOwnProperty("addEventListener")&&n(XMLHttpRequest.prototype);o.on("addEventListener-start",function(t){if(t[1]){var e=t[1];"function"==typeof e?this.wrapped=t[1]=a(e,"nr@wrapped",function(){return i(e,"fn-",null,e.name||"anonymous")}):"function"==typeof e.handleEvent&&i.inPlace(e,["handleEvent"],"fn-")}}),o.on("removeEventListener-start",function(t){var e=this.wrapped;e&&(t[1]=e)})},{1:18,2:19,ee:"QJf3ax",gos:"7eSDFh"}],5:[function(t,e){var n=(t(2),t("ee").create()),r=t(1)(n);e.exports=n,r.inPlace(window,["requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame"],"raf-"),n.on("raf-start",function(t){t[0]=r(t[0],"fn-")})},{1:19,2:18,ee:"QJf3ax"}],6:[function(t,e){function n(t,e,n){var r=t[0];"string"==typeof r&&(r=new Function(r)),t[0]=o(r,"fn-",null,n)}var r=(t(2),t("ee").create()),o=t(1)(r);e.exports=r,o.inPlace(window,["setTimeout","setInterval","setImmediate"],"setTimer-"),r.on("setTimer-start",n)},{1:19,2:18,ee:"QJf3ax"}],7:[function(t,e){function n(){c.inPlace(this,d,"fn-")}function r(t,e){c.inPlace(e,["onreadystatechange"],"fn-")}function o(t,e){return e}var i=t("ee").create(),a=t(1),s=t(2),c=s(i),u=s(a),f=window.XMLHttpRequest,d=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"];e.exports=i,window.XMLHttpRequest=function(t){var e=new f(t);try{i.emit("new-xhr",[],e),u.inPlace(e,["addEventListener","removeEventListener"],"-",function(t,e){return e}),e.addEventListener("readystatechange",n,!1)}catch(r){try{i.emit("internal-error",[r])}catch(o){}}return e},window.XMLHttpRequest.prototype=f.prototype,c.inPlace(XMLHttpRequest.prototype,["open","send"],"-xhr-",o),i.on("send-xhr-start",r),i.on("open-xhr-start",r)},{1:4,2:19,ee:"QJf3ax"}],8:[function(t){function e(t){if("string"==typeof t&&t.length)return t.length;if("object"!=typeof t)return void 0;if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if("undefined"!=typeof FormData&&t instanceof FormData)return void 0;try{return JSON.stringify(t).length}catch(e){return void 0}}function n(t){var n=this.params,r=this.metrics;if(!this.ended){this.ended=!0;for(var i=0;c>i;i++)t.removeEventListener(s[i],this.listener,!1);if(!n.aborted){if(r.duration=(new Date).getTime()-this.startTime,4===t.readyState){n.status=t.status;var a=t.responseType,u="arraybuffer"===a||"blob"===a||"json"===a?t.response:t.responseText,f=e(u);if(f&&(r.rxSize=f),this.sameOrigin){var d=t.getResponseHeader("X-NewRelic-App-Data");d&&(n.cat=d.split(", ").pop())}}else n.status=0;r.cbTime=this.cbTime,o("xhr",[n,r,this.startTime])}}}function r(t,e){var n=i(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}if(window.XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.addEventListener&&!/CriOS/.test(navigator.userAgent)){t("loader").features.xhr=!0;var o=t("handle"),i=t(2),a=t("ee"),s=["load","error","abort","timeout"],c=s.length,u=t(1);t(4),t(3),a.on("new-xhr",function(){this.totalCbs=0,this.called=0,this.cbTime=0,this.end=n,this.ended=!1,this.xhrGuids={}}),a.on("open-xhr-start",function(t){this.params={method:t[0]},r(this,t[1]),this.metrics={}}),a.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),a.on("send-xhr-start",function(t,n){var r=this.metrics,o=t[0],i=this;if(r&&o){var u=e(o);u&&(r.txSize=u)}this.startTime=(new Date).getTime(),this.listener=function(t){try{"abort"===t.type&&(i.params.aborted=!0),("load"!==t.type||i.called===i.totalCbs&&(i.onloadCalled||"function"!=typeof n.onload))&&i.end(n)}catch(e){try{a.emit("internal-error",[e])}catch(r){}}};for(var f=0;c>f;f++)n.addEventListener(s[f],this.listener,!1)}),a.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),a.on("xhr-load-added",function(t,e){var n=""+u(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),a.on("xhr-load-removed",function(t,e){var n=""+u(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),a.on("addEventListener-end",function(t,e){e instanceof XMLHttpRequest&&"load"===t[0]&&a.emit("xhr-load-added",[t[1],t[2]],e)}),a.on("removeEventListener-end",function(t,e){e instanceof XMLHttpRequest&&"load"===t[0]&&a.emit("xhr-load-removed",[t[1],t[2]],e)}),a.on("fn-start",function(t,e,n){e instanceof XMLHttpRequest&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=(new Date).getTime()))}),a.on("fn-end",function(t,e){this.xhrCbStart&&a.emit("xhr-cb-time",[(new Date).getTime()-this.xhrCbStart,this.onload,e],e)})}},{1:"XL7HBI",2:9,3:7,4:4,ee:"QJf3ax",handle:"D5DuLP",loader:"G9z0Bl"}],9:[function(t,e){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");return!r.port&&o[1]&&(r.port=o[1].split("/")[0].split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname),r.sameOrigin=!e.hostname||e.hostname===document.domain&&e.port===n.port&&e.protocol===n.protocol,r}},{}],gos:[function(t,e){e.exports=t("7eSDFh")},{}],"7eSDFh":[function(t,e){function n(t,e,n){if(r.call(t,e))return t[e];var o=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:o,writable:!0,enumerable:!1}),o}catch(i){}return t[e]=o,o}var r=Object.prototype.hasOwnProperty;e.exports=n},{}],D5DuLP:[function(t,e){function n(t,e,n){return r.listeners(t).length?r.emit(t,e,n):(o[t]||(o[t]=[]),void o[t].push(e))}var r=t("ee").create(),o={};e.exports=n,n.ee=r,r.q=o},{ee:"QJf3ax"}],handle:[function(t,e){e.exports=t("D5DuLP")},{}],XL7HBI:[function(t,e){function n(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:i(t,o,function(){return r++})}var r=1,o="nr@id",i=t("gos");e.exports=n},{gos:"7eSDFh"}],id:[function(t,e){e.exports=t("XL7HBI")},{}],loader:[function(t,e){e.exports=t("G9z0Bl")},{}],G9z0Bl:[function(t,e){function n(){var t=p.info=NREUM.info;if(t&&t.agent&&t.licenseKey&&t.applicationID&&c&&c.body){p.proto="https"===d.split(":")[0]||t.sslForHttp?"https://":"http://",a("mark",["onload",i()]);var e=c.createElement("script");e.src=p.proto+t.agent,c.body.appendChild(e)}}function r(){"complete"===c.readyState&&o()}function o(){a("mark",["domContent",i()])}function i(){return(new Date).getTime()}var a=t("handle"),s=window,c=s.document,u="addEventListener",f="attachEvent",d=(""+location).split("?")[0],p=e.exports={offset:i(),origin:d,features:{}};c[u]?(c[u]("DOMContentLoaded",o,!1),s[u]("load",n,!1)):(c[f]("onreadystatechange",r),s[f]("onload",n)),a("mark",["firstbyte",i()])},{handle:"D5DuLP"}],18:[function(t,e){function n(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(0>o?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=n},{}],19:[function(t,e){function n(t){return!(t&&"function"==typeof t&&t.apply&&!t[i])}var r=t("ee"),o=t(1),i="nr@wrapper",a=Object.prototype.hasOwnProperty;e.exports=function(t){function e(t,e,r,a){function nrWrapper(){var n,i,s,u;try{i=this,n=o(arguments),s=r&&r(n,i)||{}}catch(d){f([d,"",[n,i,a],s])}c(e+"start",[n,i,a],s);try{return u=t.apply(i,n)}catch(p){throw c(e+"err",[n,i,p],s),p}finally{c(e+"end",[n,i,u],s)}}return n(t)?t:(e||(e=""),nrWrapper[i]=!0,u(t,nrWrapper),nrWrapper)}function s(t,r,o,i){o||(o="");var a,s,c,u="-"===o.charAt(0);for(c=0;c<r.length;c++)s=r[c],a=t[s],n(a)||(t[s]=e(a,u?s+o:o,i,s,t))}function c(e,n,r){try{t.emit(e,n,r)}catch(o){f([o,e,n,r])}}function u(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){f([r])}for(var o in t)a.call(t,o)&&(e[o]=t[o]);return e}function f(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=r),e.inPlace=s,e.flag=i,e}},{1:18,ee:"QJf3ax"}]},{},["G9z0Bl",3,8]);</script></head>
<body data-slug="SpiderMonkey/Internals" contextmenu="edit-history-menu" class="document  ">

  <script type="text/javascript">
    (function(win) {
        'use strict';

                    (function(){
  var FLAGS = {
    'derby_closed': true,'dirtiness_tracking': true,'ga_outbound_links': true,'github_beta_notice': false,'kumaediting': false,'page_move': false,'promote_script': false,'redirect_messages': false,'search_suggestions': false,'top_contributors': false,'wiki_spellcheck': false
    },
    SWITCHES = {
    'wiki_error_on_delete': false,'wiki_force_immediate_rendering': false,'render_stale_documents_async': true,'enable_optimizely': true,'welcome_email': true
    },
    SAMPLES = {
    
    };
  window.waffle = {
    "flag_is_active": function waffle_flag(flag_name) {
      
      return !!FLAGS[flag_name];
    },
    "switch_is_active": function waffle_switch(switch_name) {
      
      return !!SWITCHES[switch_name];
    },
    "sample_is_active": function waffle_sample(sample_name) {
      
      return !!SAMPLES[sample_name];
    },
    "FLAGS": FLAGS,
    "SWITCHES": SWITCHES,
    "SAMPLES": SAMPLES
  };
})();

                
        // This represents the site configuration
        win.mdn = {
            build: '46533d5',
            // Properties and settings for CKEditor will go here
            ckeditor: {},
            // Feature test results and methods will be placed here
            features: {},
            // The path to media (images, CSS, JS) in MDN
            mediaPath: 'https://developer.cdn.mozilla.net/media/',
            // Optimizely API
            optimizely: win['optimizely'] || [],
            // Site notifications
                        notifications: [],
                        // Wiki-specific settings will be placed here
            wiki: {
                autosuggestTitleUrl: '/ja/docs/get-documents'
            },
            searchFilters: [{"name": "Document type", "slug": "type", "order": 1, "filters": [{"name": "Tools", "slug": "tools", "shortcut": null}, {"name": "Code Samples", "slug": "code", "shortcut": null}, {"name": "How-To & Tutorial", "slug": "howto", "shortcut": null}]}, {"name": "Skill level", "slug": "skill", "order": 1, "filters": [{"name": "I'm an Expert", "slug": "advanced", "shortcut": null}, {"name": "Intermediate", "slug": "intermediate", "shortcut": null}, {"name": "I'm Learning", "slug": "beginner", "shortcut": null}]}, {"name": "Topics", "slug": "topic", "order": 1, "filters": [{"name": "Open Web Apps", "slug": "apps", "shortcut": null}, {"name": "HTML", "slug": "html", "shortcut": null}, {"name": "CSS", "slug": "css", "shortcut": null}, {"name": "JavaScript", "slug": "js", "shortcut": null}, {"name": "APIs and DOM", "slug": "api", "shortcut": null}, {"name": "Canvas", "slug": "canvas", "shortcut": null}, {"name": "SVG", "slug": "svg", "shortcut": null}, {"name": "MathML", "slug": "mathml", "shortcut": null}, {"name": "WebGL", "slug": "webgl", "shortcut": null}, {"name": "XUL", "slug": "xul", "shortcut": null}, {"name": "Marketplace", "slug": "marketplace", "shortcut": null}, {"name": "Firefox", "slug": "firefox", "shortcut": null}, {"name": "Firefox for Android", "slug": "firefox-mobile", "shortcut": "fennec"}, {"name": "Firefox for Desktop", "slug": "firefox-desktop", "shortcut": "fx"}, {"name": "Firefox OS", "slug": "firefox-os", "shortcut": "fxos"}, {"name": "Mobile", "slug": "mobile", "shortcut": null}, {"name": "Web Development", "slug": "webdev", "shortcut": null}, {"name": "Add-ons & Extensions", "slug": "addons", "shortcut": null}, {"name": "Games", "slug": "games", "shortcut": null}, {"name": "Writing Documentation", "slug": "docs", "shortcut": null}]}]
        };

        // Ensures gettext always returns something, is always set
        win.gettext = function(x) {
            return x;
        }
    })(window);
</script>
  

  

  
  <ul id="nav-access">
    <li><a href="Internals.html#document-main" id="skip-main">メインコンテンツへ移動</a></li>
    <li><a id="skip-language" href="Internals.html#language">言語の選択</a></li>
          <li><a href="Internals.html#q" id="skip-search">検索へ移動</a></li>
      </ul>

  <!-- Header -->
  <header id="main-header"><div class="center">

    <a href="https://www.mozilla.org/" id="tabzilla" class="no-track">mozilla</a>

    <div class="clear header-clear"></div>

    <a href="../../index.html" class="logo">Mozilla Developer Network</a>

    <div class="header-login">
                    
    
    <form>
      <div class="oauth-login-container">
          <div class="oauth-login-options" tabIndex="0">
              <span class="oauth-login-options-text">
                <span class="oauth-login-options-text-icons">Sign in with</span>
                <span class="oauth-login-options-text-no-icons">Sign in</span>
              </span>
              <span class="oauth-icon oauth-persona launch-persona-login" data-service="Persona" data-next="/ja/docs/SpiderMonkey/Internals" title="Persona"><i class="icon-user" aria-hidden="true"></i></span>
                      </div>
          <div class="submenu oauth-login-picker" aria-hidden="true">
              <ul>
                  <li><a href="../../users/signin.html" class="login-link launch-persona-login" data-next="/ja/docs/SpiderMonkey/Internals" data-service="Persona"><i class="icon-user" aria-hidden="true"></i>Persona</a></li>
                              </ul>
          </div>
      </div>
    </form>
            </div>

    <nav id="main-nav" role="navigation"><ul><li><a href="https://developer.mozilla.org/en-US/docs/Zones">ゾーン<i aria-hidden="true" class="icon-caret-down"></i></a>

        <div class="submenu submenu-single" id="nav-zones-submenu">
          <div class="submenu-column">
            <ul>
              <li><a href="../Mozilla/Add-ons.html">アドオン</a></li>
              <li><a href="https://developer.mozilla.org/en-US/docs/Apps">App センター</a></li>
              <li><a href="https://developer.mozilla.org/en-US/docs/Firefox">Firefox</a></li>
              <li><a href="../Mozilla/Marketplace.html">Firefox Marketplace</a></li>
              <li><a href="https://developer.mozilla.org/en-US/docs/Firefox_OS">Firefox OS</a></li>
              <li><a href="https://developer.mozilla.org/en-US/docs/Persona">Persona</a></li>
            </ul>
          </div>
        </div>
      </li><li><a href="../Web.html">Web プラットフォーム<i aria-hidden="true" class="icon-caret-down"></i></a>

        <div class="submenu" id="nav-platform-submenu">
          <div class="submenu-column">
            <div class="title">テクノロジ</div>
            <ul>
              <li><a href="../Web/HTML.html">HTML</a></li>
              <li><a href="../Web/CSS.html">CSS</a></li>
              <li><a href="../Web/JavaScript.html">JavaScript</a></li>
              <li><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Graphics">グラフィクス</a></li>
              <li><a href="../Web/API.html">API / DOM</a></li>
              <li><a href="../Web/Apps.html">Apps</a></li>
              <li><a href="../Web/MathML.html">MathML</a></li>
            </ul>
          </div><div class="submenu-column last">
            <div class="title">リファレンスとガイド</div>
            <ul>
              <li><a href="https://developer.mozilla.org/en-US/docs/Web/Tutorials">チュートリアル</a></li>
              <li><a href="../Web/Reference.html">レファレンス</a></li>
              <li><a href="../Web/Guide.html">開発者ガイド</a></li>
              <li><a href="../Web/Accessibility.html">アクセシビリティ</a></li>
              <li><a href="../../demos/index.html">MDN デモ</a></li>
              <li><a href="../Web.html">さらに見る</a></li>
            </ul>
          </div>
        </div>
      </li><li><a href="../Tools.html">ツール</a></li><li><a href="../../demos/index.html">MDN デモ</a></li><li><a href="../Mozilla/Connect.html">Connect</a></li><li class="main-nav-search"><form action="/ja/search" method="get" role="search">
        <div class="search-wrap">
          <label for="main-q" class="offscreen">検索</label>
          <input type="search" id="main-q" name="q" data-placeholder="検索" data-value="" value="" />
          <span class="search-trigger"><i aria-hidden="true" class="icon-search"></i></span>&nbsp;
          <button type="submit" class="offscreen">検索</button>
        </div>
      </form></li></ul></nav>
  </div></header>

  <!-- Content will go here -->
  <main id="content"><div class="center clear">
  
   <!-- end is_zone -->


    <div class="wiki-main-content" id="document-main"><div class="center">
            <div class="article-meta">
        <!-- action buttons -->
        
            
        

  <ul class="page-buttons" data-sticky="false"><li><button id="languages-menu" class="transparent" aria-haspopup="true" aria-owns="languages-menu-submenu" aria-expanded="false"><span>言語</span><i aria-hidden="true" class="icon-globe"></i></button>

        <div class="submenu" id="languages-menu-submenu">
          <div class="submenu-column">
            <ul id="translations">
                                                <li><bdi><a rel="internal" href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Internals" title="SpiderMonkey Internals">English (US)</a></bdi></li>
                                  <li><bdi><a rel="internal" href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Projects/SpiderMonkey/Internals" title="SpiderMonkey Internals">中文 (简体)</a></bdi></li>
                              
                          </ul>
          </div>
        </div></li><li class="page-buttons-edit"><a href="https://developer.mozilla.org/ja/docs/SpiderMonkey/Internals$edit" class="button" data-optimizely-hook="button-edit-doc" id="edit-button">編集<i aria-hidden="true" class="icon-pencil"></i></a></li><li><button id="advanced-menu" class="only-icon" aria-haspopup="true" aria-owns="advanced-menu-submenu" aria-expanded="false"><span>詳細</span><i aria-hidden="true" class="icon-cog"></i></button>

        <div class="submenu" id="advanced-menu-submenu">
          <!-- this page -->
          <div class="submenu-column">
            <div class="title">詳細</div>
            <ul>
                <li><a href="https://developer.mozilla.org/ja/docs/SpiderMonkey/Internals$history">履歴</a></li>
                                                                
                
                                
                                                                <li class="page-print"><a href="Internals.html#" onclick="return window.print();">このページを印刷</a></li>
            </ul>
          </div>
        </div>
  </li></ul>

        <!-- crumbs -->
          <nav class="crumbs" role="navigation"><ol xmlns:v="http://rdf.data-vocabulary.org/#" aria-label="breadcrumbs">
    <li typeof="v:Breadcrumb"><a href="../../index.html" rel="v:url" property="v:title">MDN</a></li>
          <li class="crumb" typeof="v:Breadcrumb"><a href="../Mozilla.html" rel="v:url" property="v:title">Mozilla</a></li>
          <li class="crumb" typeof="v:Breadcrumb"><a href="../Mozilla/Projects.html" rel="v:url" property="v:title">Projects</a></li>
          <li class="crumb" typeof="v:Breadcrumb"><a href="../SpiderMonkey.html" rel="v:url" property="v:title">SpiderMonkey</a></li>
        <li class="crumb" typeof="v:Breadcrumb" property="v:title">Internals</li>
  </ol></nav>
      </div>

      <!-- heading -->
      <div id="wiki-document-head" class="document-head">
          <span class="from-search-previous-box">
            <a class="button from-search-previous only-icon disabled" title="Previous Search Result" data-empty-title="No Previous Search Result"><i aria-hidden="true" class="icon-chevron-left"></i></a>
          </span>
          <span class="from-search-navigate-wrap">
            <a href="Internals.html#" class="from-search-navigate"><span class="from-search-navigate-up"><i aria-hidden="true" class="icon-double-angle-up"></i></span><span class="from-search-navigate-down"><i aria-hidden="true" class="icon-double-angle-down"></i></span></a>
          </span>
          <div class="from-search-toc">
            <span class="title">Your Search Results</span>
            <ol></ol>
          </div>
          <span class="from-search-next-box">
            <a class="button from-search-next only-icon disabled" title="Next Search Result" data-empty-title="No Previous Search Result"><i aria-hidden="true" class="icon-chevron-right"></i></a>
          </span>
        <h1>Internals</h1>
        
      </div>
      
      <!-- start the main content container -->
        <div id="wiki-column-container" class="wiki-right-present wiki-left-closed wiki-left-none">

          
          <!-- content row with three strips -->
          <div class="column-container column-container-reverse">

                          <!-- TOC, approvals, etc -->
              <div class="column-strip wiki-column" id="wiki-right">
                            <!-- table of contents -->
              <div id="toc" class="toc toggleable">
                <a href="Internals.html#toc" class="title toggler" data-open-icon="icon-plus" data-closed-icon="icon-minus">In This Article<i></i></a>
                <ol class="toggle-container">
                  <li><a href="Internals.html#Design_walk-through" rel="internal">Design walk-through</a><code></code><ol><li><a href="Internals.html#Interpreter" rel="internal">Interpreter</a><code></code><code></code><code></code><code></code><code></code><code></code><li><a href="Internals.html#Compiler" rel="internal">Compiler</a><code></code><code></code><li><a href="Internals.html#Garbage_collector" rel="internal">Garbage collector</a><code></code><code></code><code></code><li><a href="Internals.html#JavaScript_values" rel="internal">JavaScript values</a><code></code><code></code><code></code><code></code><code></code><code></code><code></code><code></code><code></code><code></code><code></code><code></code><code></code><code></code><li><a href="Internals.html#Standard_library" rel="internal">Standard library</a><code></code><code></code><li><a href="Internals.html#Error_handling" rel="internal">Error handling</a><code></code><code></code><code></code><code></code><li><a href="Internals.html#Public_APIs" rel="internal">Public APIs</a><code></code><li><a href="Internals.html#Just-In-Time_compiler" rel="internal">Just-In-Time compiler</a><li><a href="Internals.html#Self-hosting_of_builtin_functions_in_JS" rel="internal">Self-hosting of builtin functions in JS</a><code></code><code></code></ol></li><li><a href="Internals.html#File_walkthrough" rel="internal">File walkthrough</a><ol><li><ol><li><a href="Internals.html#jsapi.cpp.2C_jsapi.h" rel="internal">jsapi.cpp, jsapi.h</a><li><a href="Internals.html#jspubtd.h.2C_jsprvtd.h" rel="internal">jspubtd.h, jsprvtd.h</a><code></code><code></code><li><a href="Internals.html#jsdbgapi.cpp.2C_jsdbgapi.h" rel="internal">jsdbgapi.cpp, jsdbgapi.h</a><code></code><li><a href="Internals.html#jsconfig.h" rel="internal">jsconfig.h</a><code></code><li><a href="Internals.html#js.cpp.2C_jsshell.msg" rel="internal">js.cpp, jsshell.msg</a><code></code><code></code><code></code><code></code><li><a href="Internals.html#js.msg" rel="internal">js.msg</a><li><a href="Internals.html#jsarray..2A.2C_jsbool..2A.2C_jdsdate..2A.2C_jsfun..2A.2C_jsmath..2A.2C_jsnum..2A.2C_jsstr..2A" rel="internal">jsarray.*, jsbool.*, jsdate.*, jsfun.*, jsmath.*, jsnum.*, jsstr.*</a><li><a href="Internals.html#jsobj..2A.2C_jsscope..2A" rel="internal">jsobj.*, jsscope.*</a><code></code><li><a href="Internals.html#jsatom.cpp.2C_jsatom.h" rel="internal">jsatom.cpp, jsatom.h</a><code></code><li><a href="Internals.html#jsarena.cpp.2C_jsarena.h" rel="internal">jsarena.cpp, jsarena.h</a><code></code><li><a href="Internals.html#jsgc.cpp.2C_jsgc.h" rel="internal">jsgc.cpp, jsgc.h</a><li><a href="Internals.html#jsinterp..2A.2C_jscntxt..2A.2C_jsinvoke.cpp" rel="internal">jsinterp.*, jscntxt.*, jsinvoke.cpp</a><code></code><code></code><code></code><li><a href="Internals.html#jstracer.*.2C_nanojit.2F*" rel="internal">jstracer.*, nanojit/*</a><li><a href="Internals.html#jsemit..2A.2C_jsopcode.tbl.2C_jsopcode..2A.2C_jsparse..2A.2C_jsscan..2A.2C_jsscript..2A" rel="internal">jsemit.*, jsopcode.tbl, jsopcode.*, jsparse.*, jsscan.*, jsscript.*</a><code></code><li><a href="Internals.html#jstypes.h" rel="internal">jstypes.h</a><li><a href="Internals.html#jsbit.h.2C_jslog2.cpp" rel="internal">jsbit.h, jslog2.cpp</a><code></code><li><a href="Internals.html#jsutil.cpp.2C_jsutil.h" rel="internal">jsutil.cpp, jsutil.h</a><code></code><li><a href="Internals.html#jsclist.h" rel="internal">jsclist.h</a><li><a href="Internals.html#jscpucfg.cpp" rel="internal">jscpucfg.cpp</a><li><a href="Internals.html#jsdtoa.cpp.2C_jsdtoa.h.2C_dtoa.c" rel="internal">jsdtoa.cpp, jsdtoa.h, dtoa.c</a><code></code><li><a href="Internals.html#jshash.cpp.2C_jshash.h.2C_jsdhash.cpp.2C_jsdhash.h" rel="internal">jshash.cpp, jshash.h, jsdhash.cpp, jsdhash.h</a><li><a href="Internals.html#jslong.cpp.2C_jslong.h" rel="internal">jslong.cpp, jslong.h</a><code></code><li><a href="Internals.html#jsprf..2A" rel="internal">jsprf.*</a><code></code><code></code><code></code><code></code><li><a href="Internals.html#prmjtime.c.2C_prmjtime.h" rel="internal">prmjtime.c, prmjtime.h</a><li><a href="Internals.html#jsfile.cpp.2C_jsfile.h.2C_jsfile.msg" rel="internal">jsfile.cpp, jsfile.h, jsfile.msg</a><li><a href="Internals.html#Makefile.in.2C_build.mk" rel="internal">Makefile.in, build.mk</a><li><a href="Internals.html#Makefile.ref.2C_rules.mk.2C_config.mk.2C_config.2F.2A" rel="internal">Makefile.ref, rules.mk, config.mk, config/*</a></ol></li><li><a href="Internals.html#See_also" rel="internal">See also</a></ol></li>
                </ol>
              </div>
                            </div>
            
                                                  
            <!-- center: main article content -->
            <div id="wiki-content" class="column-main wiki-column text-content">

              
              
                                                                                          
              <!-- just the article content -->
              <article id="wikiArticle">
                                                      <h2 id="Design_walk-through" name="Design_walk-through">Design walk-through</h2>
<p>At heart, SpiderMonkey is a fast interpreter that runs an untyped bytecode and operates on values of type <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/Jsval" title="SpiderMonkey/JSAPI_Reference/Jsval">jsval</a></code>—type-tagged <a class="external" href="http://blog.mozilla.com/rob-sayre/2010/08/02/mozillas-new-javascript-value-representation/" title="http://blog.mozilla.com/rob-sayre/2010/08/02/mozillas-new-javascript-value-representation/">double-sized</a> values that represent the full range of JavaScript values. In addition to the interpreter, SpiderMonkey contains a Just-In-Time (JIT) compiler, a garbage collector, code implementing the basic behavior of JavaScript values, a standard library implementing <a class="external" href="http://bclary.com/2004/11/07/#a-15">ECMA 262-3 §15</a> with various extensions, and a few public APIs.</p>
<h3 id="Interpreter" name="Interpreter">Interpreter</h3>
<p>Like many portable interpreters, SpiderMonkey's interpreter is mainly a single, tremendously long function that steps through the bytecode one instruction at a time, using a <code>switch</code> statement (or faster alternative, depending on the compiler) to jump to the appropriate chunk of code for the current instruction. A JS-to-JS function call pushes a JavaScript stack frame without growing the C stack. But since JS-to-C-to-JS call stacks are common, the interpreter is reentrant.</p>
<p>Some SpiderMonkey bytecode operations have many special cases, depending on the type of their arguments. Common cases are inlined in the interpreter loop, breaking any abstractions that stand in the way. So optimizations such as dense arrays and the property cache are, alas, <em>not</em> transparently tucked away in the <code>jsarray.*</code> and <code>jsobj.*</code> files. Both guest-star in <code>jsinterp.cpp</code> (to thunderous applause from Firefox users).</p>
<p>All state associated with an interpreter instance is passed through formal parameters to the interpreter entry point; most implicit state is collected in a type named <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/JSRuntime" title="SpiderMonkey/JSAPI_Reference/JSRuntime">JSContext</a></code>. Therefore, almost all functions in SpiderMonkey, API or not, take a <code>JSContext</code> pointer as their first argument.</p>
<h3 id="Compiler" name="Compiler">Compiler</h3>
<p>The compiler consumes JavaScript source code and produces a <em>script</em> which contains bytecode, source annotations, and a pool of string, number, and identifier literals. The script also contains objects, including any functions defined in the source code, each of which has its own, nested script.</p>
<p>The compiler consists of: a random-logic rather than table-driven lexical scanner, a recursive-descent parser that produces an AST, and a tree-walking code generator. Semantic and lexical feedback are used to disambiguate hard cases such as missing semicolons, assignable expressions ("lvalues" in C parlance), and whether <code>/</code> is the division symbol or the start of a regular expression. The compiler attempts no error recovery; it bails out on the first error. The emitter does some constant folding and a few codegen optimizations; about the fanciest thing it does is to attach source notes to the script for the decompiler's benefit.</p>
<p>The decompiler implements <code>Function.toSource()</code>, which reconstructs a function's source code. It translates postfix bytecode into infix source by consulting a separate byte-sized code, called <em>source notes</em>, to disambiguate bytecodes that result from more than one grammatical production.</p>
<h3 id="Garbage_collector" name="Garbage_collector">Garbage collector</h3>
<p>The GC is a mark-and-sweep, non-conservative (exact) collector. It is used to hold JS objects and string descriptors (but not property lists or string bytes), and double-precision floating point numbers. It runs automatically only when maxbytes (as passed to <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/JS_NewRuntime" title="SpiderMonkey/JSAPI_Reference/JS_NewRuntime">JS_NewRuntime</a></code>) bytes of GC things have been allocated and another thing-allocation request is made. JS API users should call <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/JS_GC" title="SpiderMonkey/JSAPI_Reference/JS_GC">JS_GC</a></code> or <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/JS_MaybeGC" title="SpiderMonkey/JSAPI_Reference/JS_MaybeGC">JS_MaybeGC</a></code> between script executions or from the <a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/JS_SetBranchCallback" title="SpiderMonkey/JSAPI_Reference/JS_SetBranchCallback">branch callback</a>, as often as necessary.</p>
<p>Because the GC is exact, C/C++ applications must ensure that all live objects, strings, and numbers are GC-reachable. Many techniques are available; see <a href="../SpiderMonkey_Garbage_Collection_Tips.html" title="SpiderMonkey_Garbage_Collection_Tips">SpiderMonkey Garbage Collection Tips</a>.</p>
<h3 id="JavaScript_values" name="JavaScript_values">JavaScript values</h3>
<p>The type <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/Jsval" title="SpiderMonkey/JSAPI_Reference/Jsval">jsval</a></code> represents a JavaScript value.</p>
<p>The representation is 64 bits and uses NaN-boxing on all platforms, although the exact NaN-boxing format depends on the platform. NaN-boxing is a technique based on the fact that in IEEE-754 there are 2**47 different bit patterns that all represent NaN. Hence, we can encode any floating-point value as a C++ <code>double </code>(noting that JavaScript NaN must be represented as one canonical NaN format). Other values are encoded as a value and a type tag:</p>
<ul>
  <li>On x86, ARM, and similar 32-bit platforms, we use what we call "nunboxing", in which non-<code>double </code>values are a 32-bit type tag and a 32-bit payload, which is normally either a pointer or a signed 32-bit integer. There are a few special values: <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/JSVAL_NULL" title="SpiderMonkey/JSAPI_Reference/JSVAL_NULL">JSVAL_NULL</a></code>, <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/JSVAL_VOID" title="SpiderMonkey/JSAPI_Reference/JSVAL_VOID">JSVAL_VOID</a></code> (<code>undefined</code>), <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/JSVAL_TRUE" title="SpiderMonkey/JSAPI_Reference/JSVAL_TRUE">JSVAL_TRUE</a></code>, and <code><a class="new" href="https://developer.mozilla.org/ja/docs/JSVAL_FALSE" title="JSVAL_FALSE">JSVAL_FALSE</a></code>. Another special value, <code><a class="new" href="https://developer.mozilla.org/ja/docs/JSVAL_HOLE" title="JSVAL_HOLE">JSVAL_HOLE</a></code>, is used internally only (to represent deleted <code>Array</code> elements, for example). This value is never exposed to scripts or even via the JSAPI.</li>
  <li>On x64 and similar 64-bit platforms, pointers are longer than 32 bits, so we can't use the nunboxing format. Instead, we use "punboxing", which has 17 bits of tag and 47 bits of payload.</li>
</ul>
<p>Only JIT code really depends on the layout--everything else in the engine interacts with values through functions like <code>JSVAL_IS_INT</code>. Most parts of the JIT also avoid depending directly on the layout: the files <code>PunboxAssembler.h</code> and <code>NunboxAssembler.h</code> are used to generate native code that depends on the value layout.</p>
<p>Objects consist of a possibly shared structural description, called the map or scope; and unshared property values in a vector, called the slots. Each property has an <a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/jsid" title="SpiderMonkey/JSAPI_Reference/jsid">id</a>, either a nonnegative integer or an atom (unique string), with the same tagged-pointer encoding as a <code>jsval</code>.</p>
<p>The atom manager consists of a hash table associating strings uniquely with scanner/parser information such as keyword type, index in script or function literal pool, etc. Atoms play three roles: as literals referred to by unaligned 16-bit immediate bytecode operands, as unique string descriptors for efficient property name hashing, and as members of the root GC set for exact GC.</p>
<h3 id="Standard_library" name="Standard_library">Standard library</h3>
<p>The methods for arrays, booleans, dates, functions, numbers, and strings are implemented using the JS API. Most are <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/JSFastNative" title="SpiderMonkey/JSAPI_Reference/JSFastNative">JSFastNative</a></code>s. Most string methods are customized to accept a primitive string as the <code>this</code> argument. (Otherwise, SpiderMonkey converts primitive values to objects before invoking their methods, per <a class="external" href="http://bclary.com/2004/11/07/#a-11.2.1">ECMA 262-3 §11.2.1</a>.)</p>
<h3 id="Error_handling" name="Error_handling">Error handling</h3>
<p>SpiderMonkey has two interdependent error-handling systems: JavaScript exceptions (which are <em>not</em> implemented with, or even compatible with, any kind of native C/C++ exception handling) and error reporting. In general, both functions inside SpiderMonkey and JSAPI callback functions signal errors by calling <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/JS_ReportError" title="SpiderMonkey/JSAPI_Reference/JS_ReportError">JS_ReportError</a></code> or one of its variants, or <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/JS_SetPendingException" title="SpiderMonkey/JSAPI_Reference/JS_SetPendingException">JS_SetPendingException</a></code>, and returning <code><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_Reference/JSBool" title="SpiderMonkey/JSAPI_Reference/JSBool">JS_FALSE</a></code> or <code>NULL</code>.</p>
<h3 id="Public_APIs" name="Public_APIs">Public APIs</h3>
<p>The public C/C++ interface, called the JSAPI, is in most places a thin (but source-compatible across versions) layer over the implementation. See the <a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/JSAPI_User_Guide" title="JSAPI_User_Guide">JSAPI User Guide</a>. There is an additional public API for JavaScript debuggers, <a href="https://developer.mozilla.org/ja/docs/JSDBGAPI_Reference" title="JSDBGAPI_Reference">JSDBGAPI</a>, but <code><a class="external" href="http://mxr.mozilla.org/mozilla-central/source/js/jsd/jsdebug.h" rel="custom">js/jsd/jsdebug.h</a></code> might be a better API for debuggers. Another API, <a class="new" href="https://developer.mozilla.org/ja/docs/JSXDRAPI" title="JSXDRAPI">JSXDRAPI</a>, provides serialization for JavaScript scripts. (XUL Fastload uses this.)</p>
<h3 id="Just-In-Time_compiler" name="Just-In-Time_compiler">Just-In-Time compiler</h3>
<p><span style="border: 1px solid rgb(129, 129, 81); background: rgb(255, 255, 225); font-size: 9px; vertical-align: text-top;"><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/1.8.5">SpiderMonkey 1.8.5</a> の新機能</span> SpiderMonkey contains a just-in-time compiler, code-named <em>JägerMonkey</em>, that converts bytecode to machine code for faster execution. The JIT works by detecting commonly executed functions or functions containing hot loops and then compiling these methods into machine code.</p>
<p>A second JIT, code-named <em>IonMonkey</em> was enabled in <a class="external" href="https://blog.mozilla.org/javascript/2012/09/12/ionmonkey-in-firefox-18/" title="https://blog.mozilla.org/javascript/2012/09/12/ionmonkey-in-firefox-18/">Firefox 18</a>.</p>
<h3 id="Self-hosting_of_builtin_functions_in_JS" name="Self-hosting_of_builtin_functions_in_JS">Self-hosting of builtin functions in JS</h3>
<p>Starting with Firefox 17, SpiderMonkey has the ability to implement builtin functions in self-hosted JS code. This code is compiled in a special compilation mode that gives it access to functionality that's not normally exposed to JS code, but that's required for safe and specification-conformant implementation of builtin functions.</p>
<p>All self-hosted code lives in <code>.js</code> files under <code>builtin/</code>. For details on implementing self-hosted builtins, see <a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/Internals/self-hosting" title="SpiderMonkey/self-hosting">self-hosting</a>.</p>
<h2 id="File_walkthrough" name="File_walkthrough">File walkthrough</h2>
<h4 id="jsapi.cpp.2C_jsapi.h" name="jsapi.cpp.2C_jsapi.h">jsapi.cpp, jsapi.h</h4>
<p>The public API to be used by almost all client code.</p>
<h4 id="jspubtd.h.2C_jsprvtd.h" name="jspubtd.h.2C_jsprvtd.h">jspubtd.h, jsprvtd.h</h4>
<p>These files exist to group struct and scalar typedefs so they can be used everywhere without dragging in struct definitions from N different files. The <code>jspubtd.h</code> file contains public typedefs, and is included automatically when needed. The <code>jsprvtd.h</code> file contains private typedefs and is included by various .h files that need type names, but not type sizes or declarations.</p>
<h4 id="jsdbgapi.cpp.2C_jsdbgapi.h" name="jsdbgapi.cpp.2C_jsdbgapi.h">jsdbgapi.cpp, jsdbgapi.h</h4>
<p>The debugging API. Provided so far:</p>
<p><strong>Traps</strong>, with which breakpoints, single-stepping, step over, step out, and so on can be implemented. The debugger will have to consult jsopcode.def on its own to figure out where to plant trap instructions to implement functions like step out, but a future jsdbgapi.h will provide convenience interfaces to do these things. At most one trap per bytecode can be set. When a script (<code><a class="new" href="https://developer.mozilla.org/ja/docs/JSScript" title="JSScript">JSScript</a></code>) is destroyed, all traps set in its bytecode are cleared.</p>
<p><strong>Watchpoints</strong>, for intercepting set operations on properties and running a debugger-supplied function that receives the old value and a pointer to the new one, which it can use to modify the new value being set.</p>
<p><strong>Line number</strong> to PC and back mapping functions. The line-to-PC direction "rounds" toward the next bytecode generated from a line greater than or equal to the input line, and may return the PC of a for-loop update part, if given the line number of the loop body's closing brace. Any line after the last one in a script or function maps to a PC one byte beyond the last bytecode in the script. An example, from perfect.js:</p>

<pre class="brush:js;first-line:14">function perfect(n) {
  print("The perfect numbers up to " + n + " are:");

  // We build sumOfDivisors[i] to hold a string expression for
  // the sum of the divisors of i, excluding i itself.
  var sumOfDivisors = new ExprArray(n+1,1);
  for (var divisor = 2; divisor &lt;= n; divisor++) {
    for (var j = divisor + divisor; j &lt;= n; j += divisor) {
      sumOfDivisors[j] += " + " + divisor;
    }
    // At this point everything up to 'divisor' has its sumOfDivisors
    // expression calculated, so we can determine whether it's perfect
    // already by evaluating.
    if (eval(sumOfDivisors[divisor]) == divisor) {
      print("" + divisor + " = " + sumOfDivisors[divisor]);
    }
  }
  delete sumOfDivisors;
  print("That's all.");
}</pre>

<p>The line number to PC and back mappings can be tested using the js program with the following script:</p>

<pre class="brush:js">load("perfect.js");
print(perfect);
dis(perfect);
print();
for (var ln = 0; ln &lt;= 40; ln++) {
    var pc = line2pc(perfect, ln);
    var ln2 = pc2line(perfect, pc);
    print("\tline " + ln + " =&gt; pc " + pc + " =&gt; line " + ln2);
}</pre>

<p>The result of the for loop over lines 0 to 40 inclusive is:</p>
<pre>line 0 =&gt; pc 0 =&gt; line 16
line 1 =&gt; pc 0 =&gt; line 16
line 2 =&gt; pc 0 =&gt; line 16
line 3 =&gt; pc 0 =&gt; line 16
line 4 =&gt; pc 0 =&gt; line 16
line 5 =&gt; pc 0 =&gt; line 16
line 6 =&gt; pc 0 =&gt; line 16
line 7 =&gt; pc 0 =&gt; line 16
line 8 =&gt; pc 0 =&gt; line 16
line 9 =&gt; pc 0 =&gt; line 16
line 10 =&gt; pc 0 =&gt; line 16
line 11 =&gt; pc 0 =&gt; line 16
line 12 =&gt; pc 0 =&gt; line 16
line 13 =&gt; pc 0 =&gt; line 16
line 14 =&gt; pc 0 =&gt; line 16
line 15 =&gt; pc 0 =&gt; line 16
line 16 =&gt; pc 0 =&gt; line 16
line 17 =&gt; pc 19 =&gt; line 20
line 18 =&gt; pc 19 =&gt; line 20
line 19 =&gt; pc 19 =&gt; line 20
line 20 =&gt; pc 19 =&gt; line 20
line 21 =&gt; pc 36 =&gt; line 21
line 22 =&gt; pc 53 =&gt; line 22
line 23 =&gt; pc 74 =&gt; line 23
line 24 =&gt; pc 92 =&gt; line 22
line 25 =&gt; pc 106 =&gt; line 28
line 26 =&gt; pc 106 =&gt; line 28
line 27 =&gt; pc 106 =&gt; line 28
line 28 =&gt; pc 106 =&gt; line 28
line 29 =&gt; pc 127 =&gt; line 29
line 30 =&gt; pc 154 =&gt; line 21
line 31 =&gt; pc 154 =&gt; line 21
line 32 =&gt; pc 161 =&gt; line 32
line 33 =&gt; pc 172 =&gt; line 33
line 34 =&gt; pc 172 =&gt; line 33
line 35 =&gt; pc 172 =&gt; line 33
line 36 =&gt; pc 172 =&gt; line 33
line 37 =&gt; pc 172 =&gt; line 33
line 38 =&gt; pc 172 =&gt; line 33
line 39 =&gt; pc 172 =&gt; line 33
line 40 =&gt; pc 172 =&gt; line 33
</pre>
<h4 id="jsconfig.h" name="jsconfig.h">jsconfig.h</h4>
<p>Various configuration macros defined as 0 or 1 depending on how <code><a class="new" href="https://developer.mozilla.org/ja/docs/JS_VERSION" title="JS_VERSION">JS_VERSION</a></code> is defined (as 10 for JavaScript 1.0, 11 for JavaScript 1.1, etc.). Not all macros are tested around related code yet. In particular, JS 1.0 support is missing from SpiderMonkey.</p>
<h4 id="js.cpp.2C_jsshell.msg" name="js.cpp.2C_jsshell.msg">js.cpp, jsshell.msg</h4>
<p>The "JS shell", a simple interpreter program that uses the JS API and more than a few internal interfaces (some of these internal interfaces could be replaced by <code>jsapi.h</code> calls). The js program built from this source provides a test vehicle for evaluating scripts and calling functions, trying out new debugger primitives, etc.</p>
<p>A look at the places where <code>jsshell.msg</code> is used in <code>js.cpp</code> shows how error messages can be handled in JSAPI applications. These messages can be localized at compile time by replacing the <code>.msg</code> file; or, with a little modification to the source, at run time.</p>
<p><a href="Introduction_to_the_JavaScript_shell.html" title="https://developer.mozilla.org/en/introduction_to_the_javascript_shell">More information on the JavaScript shell</a>.</p>
<h4 id="js.msg" name="js.msg">js.msg</h4>
<p>SpiderMonkey error messages.</p>
<h4 id="jsarray..2A.2C_jsbool..2A.2C_jdsdate..2A.2C_jsfun..2A.2C_jsmath..2A.2C_jsnum..2A.2C_jsstr..2A" name="jsarray..2A.2C_jsbool..2A.2C_jdsdate..2A.2C_jsfun..2A.2C_jsmath..2A.2C_jsnum..2A.2C_jsstr..2A">jsarray.*, jsbool.*, jsdate.*, jsfun.*, jsmath.*, jsnum.*, jsstr.*</h4>
<p>These file pairs implement the standard classes and (where they exist) their underlying primitive types. They have similar structure, generally starting with class definitions and continuing with internal constructors, finalizers, and helper functions.</p>
<h4 id="jsobj..2A.2C_jsscope..2A" name="jsobj..2A.2C_jsscope..2A">jsobj.*, jsscope.*</h4>
<p>These two pairs declare and implement the JS object system. All of the following happen here:</p>
<ul>
  <li>creating objects by class and prototype, and finalizing objects;</li>
  <li>defining, looking up, getting, setting, and deleting properties;</li>
  <li>creating and destroying properties and binding names to them.</li>
</ul>
<p>The details of a native object's map (scope) are mostly hidden in <code>jsscope.[ch]</code>.</p>
<h4 id="jsatom.cpp.2C_jsatom.h" name="jsatom.cpp.2C_jsatom.h">jsatom.cpp, jsatom.h</h4>
<p>The atom manager. Contains well-known string constants, their atoms, the global atom hash table and related state, the js_Atomize() function that turns a counted string of bytes into an atom, and literal pool (<code>JSAtomMap</code>) methods.</p>
<h4 id="jsarena.cpp.2C_jsarena.h" name="jsarena.cpp.2C_jsarena.h">jsarena.cpp, jsarena.h</h4>
<p>Last-In-First-Out allocation macros that amortize malloc costs and allow for en-masse freeing. See the paper mentioned in <code>jsarena.h</code>'s major comment.</p>
<h4 id="jsgc.cpp.2C_jsgc.h" name="jsgc.cpp.2C_jsgc.h">jsgc.cpp, jsgc.h</h4>
<p>The garbage collector and tracing routines.</p>
<h4 id="jsinterp..2A.2C_jscntxt..2A.2C_jsinvoke.cpp" name="jsinterp..2A.2C_jscntxt..2A.2C_jsinvoke.cpp">jsinterp.*, jscntxt.*, jsinvoke.cpp</h4>
<p>The bytecode interpreter, and related functions such as Call and AllocStack, live in <em>jsinterp.cpp</em>. The JSContext constructor and destructor are factored out into <em>jscntxt.cpp</em> for minimal linking when the compiler part of JS is split from the interpreter part into a separate program.</p>
<p><code>jsinvoke.cpp</code> is a build hack used on some platforms to build <code>js_Interpret</code> under different compiler options from the rest of <code>jsinterp.cpp</code>.</p>
<h4 id="jstracer.*.2C_nanojit.2F*" name="jstracer.*.2C_nanojit.2F*">jstracer.*, nanojit/*</h4>
<p><a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/Internals/Tracing_JIT" title="SpiderMonkey/Internals/Tracing JIT">The tracing JIT</a>. The interface between the JIT and the rest of SpiderMonkey is conceptually small—the interpreter calls into the trace recorder—but as with everything else, there are tendrils everywhere.</p>
<h4 id="jsemit..2A.2C_jsopcode.tbl.2C_jsopcode..2A.2C_jsparse..2A.2C_jsscan..2A.2C_jsscript..2A" name="jsemit..2A.2C_jsopcode.tbl.2C_jsopcode..2A.2C_jsparse..2A.2C_jsscan..2A.2C_jsscript..2A">jsemit.*, jsopcode.tbl, jsopcode.*, jsparse.*, jsscan.*, jsscript.*</h4>
<p>Compiler and decompiler modules. The <em>jsopcode.tbl</em> file is a C preprocessor source that defines almost everything there is to know about JS bytecodes. See its major comment for how to use it. For now, a debugger will use it and its dependents such as <em>jsopcode.h</em> directly, but over time we intend to extend <em>jsdbgapi.h</em> to hide uninteresting details and provide conveniences. The code generator is split across paragraphs of code in <em>jsparse.cpp</em>, and the utility methods called on <code>JSCodeGenerator</code> appear in <em>jsemit.cpp</em>. Source notes generated by <em>jsparse.cpp</em> and <em>jsemit.cpp</em> are used in <em>jsscript.cpp</em> to map line number to program counter and back.</p>
<h4 id="jstypes.h" name="jstypes.h">jstypes.h</h4>
<p>Fundamental representation types and utility macros. This file alone among all .h files in SpiderMonkey must be included first by .cpp files. It is not nested in .h files, as other prerequisite .h files generally are, since it is also a direct dependency of most .cpp files and would be over-included if nested in addition to being directly included.</p>
<h4 id="jsbit.h.2C_jslog2.cpp" name="jsbit.h.2C_jslog2.cpp">jsbit.h, jslog2.cpp</h4>
<p>Bit-twiddling routines. Most of the work here is selectively enabling compiler-specific intrinsics such as GCC's <code>__builtin_ctz</code>, which is useful in calculating base-2 logarithms of integers.</p>
<h4 id="jsutil.cpp.2C_jsutil.h" name="jsutil.cpp.2C_jsutil.h">jsutil.cpp, jsutil.h</h4>
<p>The <code>JS_ASSERT</code> macro is used throughout the source as a proof device to make invariants and preconditions clear to the reader, and to hold the line during maintenance and evolution against regressions or violations of assumptions that it would be too expensive to test unconditionally at run-time. Certain assertions are followed by run-time tests that cope with assertion failure, but only where I'm too smart or paranoid to believe the assertion will never fail...</p>
<h4 id="jsclist.h" name="jsclist.h">jsclist.h</h4>
<p>Doubly-linked circular list struct and macros.</p>
<h4 id="jscpucfg.cpp" name="jscpucfg.cpp">jscpucfg.cpp</h4>
<p>This standalone program generates <em>jscpucfg.h</em>, a header file containing bytes per word and other constants that depend on CPU architecture and C compiler type model. It tries to discover most of these constants by running its own experiments on the build host, so if you are cross-compiling, beware.</p>
<h4 id="jsdtoa.cpp.2C_jsdtoa.h.2C_dtoa.c" name="jsdtoa.cpp.2C_jsdtoa.h.2C_dtoa.c">jsdtoa.cpp, jsdtoa.h, dtoa.c</h4>
<p>dtoa.c contains David Gay's portable double-precision floating point to string conversion code, with Permission To Use notice included. jsdtoa.cpp <code>#include</code>s this file.</p>
<h4 id="jshash.cpp.2C_jshash.h.2C_jsdhash.cpp.2C_jsdhash.h" name="jshash.cpp.2C_jshash.h.2C_jsdhash.cpp.2C_jsdhash.h">jshash.cpp, jshash.h, jsdhash.cpp, jsdhash.h</h4>
<p>Portable, extensible hash tables. These use multiplicative hash for strength reduction over division hash, yet with very good key distribution over power of two table sizes. jshash resolves collisions via chaining, so each entry burns a malloc and can fragment the heap. jsdhash uses open addressing.</p>
<h4 id="jslong.cpp.2C_jslong.h" name="jslong.cpp.2C_jslong.h">jslong.cpp, jslong.h</h4>
<p>64-bit integer emulation, and compatible macros that use intrinsic C types, like <code>long long</code>, on platforms where they exist (most everywhere, these days).</p>
<h4 id="jsprf..2A" name="jsprf..2A">jsprf.*</h4>
<p>Portable, buffer-overrun-resistant sprintf and friends. For no good reason save lack of time, the %e, %f, and %g formats cause your system's native sprintf, rather than <code>JS_dtoa()</code>, to be used. This bug doesn't affect SpiderMonkey, because it uses its own <code>JS_dtoa()</code> call in <code>jsnum.cpp</code> to convert from double to string, but it's a bug that we'll fix later, and one you should be aware of if you intend to use a <code>JS_*printf()</code> function with your own floating type arguments - various vendor sprintf's mishandle NaN, +/-Inf, and some even print normal floating values inaccurately.</p>
<h4 id="prmjtime.c.2C_prmjtime.h" name="prmjtime.c.2C_prmjtime.h">prmjtime.c, prmjtime.h</h4>
<p>Time functions. These interfaces are named in a way that makes local vs. universal time confusion likely. Caveat emptor, and we're working on it. To make matters worse, Java (and therefore JavaScript) uses "local" time numbers (offsets from the epoch) in its Date class.</p>
<h4 id="jsfile.cpp.2C_jsfile.h.2C_jsfile.msg" name="jsfile.cpp.2C_jsfile.h.2C_jsfile.msg">jsfile.cpp, jsfile.h, jsfile.msg</h4>
<p>Obsolete. Do not use these files.</p>
<h4 id="Makefile.in.2C_build.mk" name="Makefile.in.2C_build.mk">Makefile.in, build.mk</h4>
<p>Mozilla makefiles. If you're building Gecko or Firefox, the larger build system will use these files. They are also used for current standalone builds.</p>
<h4 id="Makefile.ref.2C_rules.mk.2C_config.mk.2C_config.2F.2A" name="Makefile.ref.2C_rules.mk.2C_config.mk.2C_config.2F.2A">Makefile.ref, rules.mk, config.mk, config/*</h4>
<p>Obsolete SpiderMonkey standalone makefiles from 1.8 and earlier. See <a class="new" href="https://developer.mozilla.org/ja/docs/SpiderMonkey/Build_Documentation#Building_SpiderMonkey_1.8_or_earlier" title="SpiderMonkey/Build Documentation#Building SpiderMonkey 1.8 or earlier">SpiderMonkey Build Documentation</a>.</p>
<h3 id="See_also" name="See_also">See also</h3>
<ul>
<li><a href="https://developer.mozilla.org/jsd" title="jsd">jsd</a></li>
</ul>
                                                </article>

              
                <!-- contributors -->
                <div class="wiki-block contributors">
                  <h2 class="offscreen">Document Tags and Contributors</h2>
                                                      <!-- tags if present -->
                  <div class="tag-attach-list contributor-sub">
                    <i aria-hidden="true" class="icon-tags"></i><strong>タグ:</strong>&nbsp;
                    <ul class="tags tags-small"><li><a href="https://developer.mozilla.org/ja/docs/tag/%E8%A6%81%E7%BF%BB%E8%A8%B3">要翻訳</a></li><li><a href="../tag/SpiderMonkey.html">SpiderMonkey</a></li><li><a href="../tag/要更新.html">要更新</a></li><li><a href="../tag/JavaScript.html">JavaScript</a></li></ul>
                  </div>
                                    <div class="contributor-sub"> <i aria-hidden="true" class="icon-group"></i><strong>Contributors to this page:</strong> <a href="../../profiles/saneyuki_s.html">saneyuki_s</a>, <a href="../../profiles/ethertank.html">ethertank</a> </div>                                      <div class="contributor-sub">
                      <i aria-hidden="true" class="icon-clock-o"></i><strong>最終更新者:</strong>
                      <a href="../../profiles/ethertank.html">ethertank</a>,
                      <time datetime="2013-04-26T17:56:46-07:00">2013/04/26 17:56:46</time>
                    </div>
                                  </div>
                          </div>

                      </div>
        </div>
      </div>
    </div> <!-- ends "main-content" -->

  <menu type="context" id="edit-history-menu">
    <menuitem data-action="$edit" label="ページを編集"></menuitem>
    <menuitem data-action="$history" label="ページの履歴を表示"></menuitem>
  </menu>
  </div></main>

  <!-- Footer -->
  <footer><div class="center">
    <div class="column-container">
      <div class="column-main">
                <p>
          <bdi>&copy; 2005-2014 Mozilla Developer Network and individual contributors<br /> Content is available under <a href="https://developer.mozilla.org/en-US/docs/Project:MDN/About#Copyrights_and_licenses">these licenses</a> &middot; <a href="https://developer.mozilla.org/en-US/docs/Project:MDN/About">About MDN</a> &middot; <a href="https://github.com/mozilla/kuma">Contribute to the code</a> &middot; <a href="https://www.mozilla.org/privacy/websites/">Privacy policy</a></bdi>        </p>
              </div>
      <div class="column-strip">
                        <form class="languages go" method="get" action="/ja/docs/Web">
      <label for="language">他の言語:</label>
      <select id="language" class="wiki-l10n" name="next" dir="ltr">
        <option value="/ja/docs/SpiderMonkey/Internals" selected>
          日本語
        </option>
                  <option value="/en-US/docs/Mozilla/Projects/SpiderMonkey/Internals">
            English (US)
          </option>          <option value="/zh-CN/docs/Mozilla/Projects/SpiderMonkey/Internals">
            中文 (简体)
          </option>      </select>
      <noscript><button type="submit">移動</button></noscript>
    </form>
                </div>
    </div>
  </div></footer>

  <!-- site js -->
    <script src="https://developer.mozilla.org/ja/jsi18n/build:46533d5"></script>
  
      <!--[if lte IE 8]><script src="/media/js/libs/selectivizr-1.0.2/selectivizr-build.js"></script><![endif]-->

    <script src="https://login.persona.org/include.js"></script>
<form id="_persona_login" method="post" action="/users/persona/signin" data-csrf-token-url="/users/persona/csrf" data-request='{"siteName": "Mozilla Developer Network", "siteLogo": "/media/redesign/img/opengraph-logo.png"}'>
  <input type="hidden" name="csrfmiddlewaretoken" value="" id="_persona_csrf_token" />
  <input type="hidden" name="next" value="" id="_persona_next_url"/>
  <input type="hidden" name="process" value="" id="_persona_process"/>
  <input type="hidden" name="assertion" id="_persona_assertion"/>
</form>

    <script src="https://developer.cdn.mozilla.net/media/js/main-min.js?build=46533d5"></script>

          <script>
        if(window.mdn && mdn.analytics) mdn.analytics.trackOutboundLinks();
      </script>
    
          <script src="https://developer.cdn.mozilla.net/media/js/wiki-min.js?build=46533d5"></script>
      
    <script type="text/javascript">
      if(window.jQuery) jQuery('.from-search-toc').mozSearchResults('');
  </script>
<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"beacon-3.newrelic.com","queueTime":0,"licenseKey":"42869b6ed3","agent":"js-agent.newrelic.com/nr-476.min.js","transactionName":"b1QHMUtVDRdSW0YKXVYeIxBXVxcNXFYdCEdVUEsSUF8KSkVRVxRBAlUKBkxZBgpH","applicationID":"3172075","errorBeacon":"bam.nr-data.net","applicationTime":354}</script></body>
</html>